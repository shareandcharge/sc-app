<ion-header>

    <ion-navbar>
        <ion-title *ngIf="flowMode=='edit'">{{'station.edit_charging_station' | translate}}</ion-title>
        <ion-title *ngIf="flowMode=='add'">{{'station.add_charging_station' | translate}}</ion-title>

        <ion-buttons end>
            <button ion-button icon-only="" (click)="skipAddingStation()">
                <ion-icon name="md-close"></ion-icon>
            </button>
        </ion-buttons>
    </ion-navbar>

    <progress-bar [progress]="10"></progress-bar>
</ion-header>


<ion-content>
    <div class="image-wrapper">
        <div #map id="map" (click)="detailedMap()">
        </div>
    </div>
    <div padding="">
        <ion-list no-lines>
            <ion-item>
                <!-- floating label does not work with clearInput (?) -->
                <ion-label stacked>{{'station.station_address' | translate}}</ion-label>
                <ion-input type="text" class="input-white" [(ngModel)]="locObject.address" (input)="updateSearch()" clearInput></ion-input>
            </ion-item>
            <div *ngIf="errorMessages.address" class="alert-box alert-box-danger" margin>
                {{ errorMessages.address }}
            </div>
            <ion-item>
                <ion-label stacked>{{'station.station_name' | translate}}</ion-label>
                <ion-input type="text" class="input-white" [(ngModel)]="locObject.name" placeholder="Typ 2 am Stadtpark"></ion-input>
            </ion-item>
        </ion-list>
        <ion-list>
            <ion-item *ngFor="let item of autocompleteItems" tappable (click)="chooseItem(item)">
                <ion-icon name="pin" item-left></ion-icon>
                {{ item.description }}
            </ion-item>
        </ion-list>

        <ion-segment color="primary" [(ngModel)]="segmentTabs" padding>
            <ion-segment-button value="default" (click)="updateSelectedDays()">
                {{'station.opening_time' | translate}}
            </ion-segment-button>
            <ion-segment-button value="custom">
                {{'station.adapt' | translate}}
            </ion-segment-button>
        </ion-segment>

        <div *ngIf="segmentTabs == 'default'">
            <ion-list no-lines="">
                <ion-item>
                    <ion-grid item-content class="nopadding-outer">
                        <ion-row>
                            <ion-col width-50="">{{'common.from' | translate}}</ion-col>
                            <ion-col width-50="">{{'common.to' | translate}}</ion-col>
                        </ion-row>
                        <ion-row>
                            <ion-col width-50="">
                                <ion-select class="input-white select-multiline" [(ngModel)]="from" (ngModelChange)="updateSelectedDays()" cancelText="Abbrechen" okText="OK" placeholder="Uhrzeit" [selectOptions]="{title: 'Von'}">
                                    <ion-option *ngFor="let t of dayHours" [value]="t.value">{{t.title}}</ion-option>
                                </ion-select>
                            </ion-col>
                            <ion-col width-50="">
                                <ion-select class="input-white select-multiline" [(ngModel)]="to" (ngModelChange)="updateSelectedDays()" cancelText="Abbrechen" okText="OK" placeholder="Uhrzeit" [selectOptions]="{title: 'Bis'}">
                                    <ion-option *ngFor="let t of dayHours" [value]="t.value">{{t.title}}</ion-option>
                                </ion-select>
                            </ion-col>
                        </ion-row>
                    </ion-grid>
                </ion-item>

                <ion-item>
                    <ion-label>{{'station.days' | translate}}</ion-label>
                </ion-item>
                <ion-item>
                    <ion-select multiple="true"
                                [(ngModel)]="weekdays" (ngModelChange)="updateSelectedDays()"
                                [selectOptions]="daySelectOptions"
                                class="select-multiline input-white"
                                placeholder="{{'station.choose' | translate}}"
                                cancelText="{{'common.cancel' | translate}}" okText="{{'common.ok' | translate}}"
                    >
                        <ion-option value="0">Montag</ion-option>
                        <ion-option value="1">Dienstag</ion-option>
                        <ion-option value="2">Mittwoch</ion-option>
                        <ion-option value="3">Donnerstag</ion-option>
                        <ion-option value="4">Freitag</ion-option>
                        <ion-option value="5">Samstag</ion-option>
                        <ion-option value="6">Sonntag</ion-option>
                    </ion-select>
                </ion-item>
                <div *ngIf="errorMessages.openingHours" class="alert-box alert-box-danger" margin>
                    {{ errorMessages.openingHours }}
                </div>
            </ion-list>
        </div>

        <ion-list no-lines="" *ngIf="segmentTabs == 'custom'">
            <ion-item *ngFor="let day of customWeekCalendar.hours; let i = index;">
                <ion-label>{{days[i]}}</ion-label>
                <ion-checkbox [(ngModel)]="day.from != day.to" (ngModelChange)="setDayClosed(day)"></ion-checkbox>
                <ion-select [(ngModel)]="day.from" placeholder="{{'common.from' | translate}}" class="input-white small margin-right-xs" [selectOptions]="{title: days[i] + ' von'}">
                    <ion-option *ngFor="let t of dayHours" [value]="t.value">{{t.title}}</ion-option>
                </ion-select>   
                <ion-select [(ngModel)]="day.to" placeholder="{{'common.to' | translate}}" class="input-white small" [selectOptions]="{title: days[i] + ' bis'}">
                    <ion-option *ngFor="let t of dayHours" [value]="t.value">{{t.title}}</ion-option>
                </ion-select>
            </ion-item>
            <div *ngIf="errorMessages.openingHours" class="alert-box alert-box-danger" margin>
                {{ errorMessages.openingHours }}
            </div>
        </ion-list>

        <ion-list no-lines="">
            <ion-item>
                <ion-label stacked>{{'station.contact_person' | translate}}</ion-label>
                <ion-textarea class="input-white" [(ngModel)]="locObject.metadata.problemSolver" rows="3"></ion-textarea>
            </ion-item>

            <ion-item>
                <ion-label stacked>{{'station.description' | translate}}</ion-label>
                <ion-textarea class="input-white" [(ngModel)]="locObject.description" rows="3"></ion-textarea>
            </ion-item>
        </ion-list>

        <div padding text-center>
            <button ion-button round (click)="continueAddStation()" text-uppercase outline block>Weiter</button>
            <button ion-button round *ngIf="flowMode==='edit'" (click)="saveChanges()" text-uppercase block>
                {{'station.save_changes' | translate}}
            </button>
        </div>
    </div>
</ion-content>
