<ion-header>

    <ion-navbar>
        <ion-title>Ladevorgang</ion-title>
        <ion-buttons end>
            <button ion-button icon-only (click)="dismiss()">
                <ion-icon name="close"></ion-icon>
            </button>
        </ion-buttons>
    </ion-navbar>
</ion-header>


<ion-content padding class="content-white">
    <ion-fab top right #fabCar *ngIf="activeCar">
        <button ion-fab class="fab-image">
            <span class="image-wrapper">
                <img [ngStyle]="{'background-image':'url(' + activeCar.displayImageSrc + ')'}">
            </span>
        </button>
    </ion-fab>

    <div class="top-item-text">
        <ion-icon name="cust-station-pin" color="secondary"></ion-icon>
        <div class="text">{{this.location.address}}</div>
    </div>
    <div class="top-item-text">
        <ion-icon name="cust-time-money" color="secondary"></ion-icon>
        <div class="text" *ngIf="chargingTypeText">
            {{"tariff.types." + chargingTypeText|translate}}:
            <ng-container *ngIf="chargingPricePerHour != 0">
                {{chargingPricePerHour/100 | currency:'EUR':true:'1.2-2'}}
                <span *ngIf="chargingTypeText == 'hourly' || chargingTypeText == 'kwh'">/h</span>
                <span class="vat" *ngIf="includingVat">(inkl. 19% MwSt.)</span>
            </ng-container>
            <ng-container *ngIf="chargingPricePerHour == 0">
                Kostenlos
            </ng-container>
        </div>
    </div>

    <hr>

    <div text-center *ngIf="countingDown" class="big-header">{{chargingTimeHours}}</div>
    <div ion-text text-center *ngIf="activeCar == null" color="danger">Du musst erst ein Elektroauto hinzuf√ºgen bevor Du
        laden kannst.
    </div>

    <div text-center class="price-label" *ngIf="activeCar != null">
        <span *ngIf="!countingDown"> Voraussichtlicher Preis: </span>
        <ng-container *ngIf="chargingPrice != 0">
            {{(chargingPrice / 100) | currency:'EUR':true:'1.2-2'}} <br>
            <span class="vat" *ngIf="includingVat">(inkl. 19% MwSt.)</span>
        </ng-container>
        <ng-container *ngIf="chargingPrice == 0">
            Kostenlos
        </ng-container>
    </div>

    <div class="progress-wrapper">
        <div class="battery-charging" *ngIf="charging"><img src="assets/images/battery-charging.gif"></div>
        <canvas id="circleProgressBar" width="280" height="280"></canvas>
    </div>

    <div class="owner-wrapper">
        <p>
            <strong>Betreiber:</strong>

            <span *ngIf="location.ownerprofile.company">
                <br>{{ location.ownerprofile.company }}
            </span>
            <span *ngIf="location.ownerprofile.firstname || location.ownerprofile.lastname">
                <br>{{ location.ownerprofile.firstname }} {{ location.ownerprofile.lastname }}
            </span>
            <span *ngIf="location.ownerprofile.address">
                <br>{{ location.ownerprofile.address }}
            </span>
            <span *ngIf="location.ownerprofile.postalCode || location.ownerprofile.zip">
                <br>{{ location.ownerprofile.postalCode }} {{ location.ownerprofile.city }}
            </span>
            <span *ngIf="location.ownerprofile.operatorVat && location.ownerprofile.operatorVatID">
                <br>Steuernummer: {{ location.ownerprofile.operatorVatID }}
            </span>
        </p>
        <p>
            Es gelten die <a (click)="openTerms()">AGBs</a> des Ladestationsbetreibers.
        </p>
    </div>

</ion-content>
<ion-footer>
    <ion-toolbar color="light">
        <div text-center *ngIf="countingDown">
            <button ion-button round text-uppercase color="danger" (click)="stopCharging()" [disabled]="stopButtonDisabled">
                Stop
            </button>
        </div>
        <div text-center *ngIf="!countingDown">

            <ng-container *ngIf="station.connectors.length > 1">
                <ion-list no-lines class="no-margin-bottom">
                    <ion-item>
                        <ion-label>Ladepunkt:</ion-label>
                        <ion-select
                                [(ngModel)]="selectedConnectorId"
                                cancelText="Abbrechen" okText="OK"
                                (ngModelChange)="selectConnector()"
                        >
                            <ion-option
                                    *ngFor="let conn of station.connectors"
                                    [value]="conn.id"
                                    [disabled]="conn.isRented"
                            >
                                {{conn.getTitle()}}
                            </ion-option>
                        </ion-select>
                    </ion-item>
                </ion-list>
                <hr>
            </ng-container>

            <ion-list no-lines="" class="no-margin-bottom">
                <ion-item text-wrap class="item-partial-cover-cb">
                    <ion-checkbox [(ngModel)]="termsChecked" class="checkbox-square"></ion-checkbox>
                    <ion-label>Ich akzeptiere die <a (click)="openTerms()">AGBs</a> des Ladestationsbetreibers.</ion-label>
                </ion-item>
            </ion-list>
            <button ion-button round text-uppercase (click)="startCharging()" [disabled]="buttonDeactive || !termsChecked">
                Zahlungspflichtig laden
            </button>
        </div>
    </ion-toolbar>
</ion-footer>
